(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();const e=t.p+"011681cb3ed4e6b06094bdd21d0c5d0a.png";class s extends Phaser.Scene{constructor(){super({key:"MainMenu"})}preload(){this.load.image("bg",e)}create(){this.add.image(this.game.config.width/2,this.game.config.height/2,"bg").setScale(.5),this.title=this.add.text(.5*this.game.config.width,.2*this.game.config.height,"THE AIR GUARD",{fontFamily:"monospace",fontSize:48,fontStyle:"bold",color:"#000",align:"center"}),this.title.setOrigin(.5);const t=prompt("Please enter your name","Guest");null===t||"name"===t.toLowerCase||""===t.trim()?localStorage.setItem("playerName","Guest"):localStorage.setItem("playerName",t),this.playerName=this.add.text(.5*this.game.config.width,.3*this.game.config.height,`Hi ${localStorage.getItem("playerName")}`,{fontFamily:"monospace",fontSize:24,fontStyle:"bold",color:"#000",align:"center"}),this.playerName.setOrigin(.5),this.intro=this.add.text(.5*this.game.config.width,.4*this.game.config.height,"Shoot down as many stray planes as you can to protect our airspace.\n      Use the left and right arrow-keys to move the player and the up arrow-key to shoot missiles",{fontFamily:"monospace",fontSize:16,fontStyle:"bold",color:"#000",align:"center"}),this.intro.setOrigin(.5),this.start=this.add.text(.5*this.game.config.width,.6*this.game.config.height,"START GAME >",{fontFamily:"monospace",fontSize:30,fontStyle:"bold",color:"red",align:"center"}),this.start.setOrigin(.5),this.start.setInteractive(),this.start.on("pointerup",(function(){this.scene.start("GamePlay")}),this)}}const i=s,a=t.p+"06812832c768ffc175921b6d3a578684.png",o=t.p+"4d54413d1630f8a7575db80042794c5b.png",h=t.p+"fb7330a1b46c2c11d6868b1de2adb743.png",n=t.p+"7b45144200993ffbf2e3d9063e190a7a.png",r=t.p+"043c56409310a194998085b5c18c34f4.png",c=t.p+"bd193892f478770d941214338896c648.wav",l=t.p+"0fa9e1340470d9a5a1f519da7a1e18dd.wav",d=(t,e)=>{e.forEach((e=>{(e.x<-e.displayWidth||e.x>t.game.config.width+e.displayWidth||e.y<4*-e.displayHeight||e.y>t.game.config.height+e.displayHeight)&&e&&e.destroy()}))};class g extends Phaser.GameObjects.Sprite{constructor(t,e,s,i){super(t,e,s,i),this.scene=t,this.scene.add.existing(this),this.scene.physics.world.enableBody(this,0)}}class p extends g{constructor(t,e,s,i,a,o){super(t,e,s,i),this.body.velocity.x=-Phaser.Math.Between(a,o)}explode(){this.scene.strayPlanes.remove(this),this.scene.score+=1,this.setTexture("sprExplosion"),this.body.setVelocity(-150,0),this.setScale(1),this.play("sprExplosion"),this.scene.sfx.explosion.play(),this.on("animationcomplete",(function(){this.destroy()}),this)}}class m extends g{constructor(t,e,s,i,a,o){super(t,e,s,i),this.body.velocity.x=a,this.body.velocity.y=o}}const y=class extends g{constructor(t,e,s,i,a){super(t,e,s,i),this.rounds=a,this.setData("speed",200),this.setData("rounds",a),this.setData("isShooting",!1),this.setData("timerShootDelay",50),this.setData("timerShootTick",this.getData("timerShootDelay")-1)}moveLeft(){this.body.velocity.x=-this.getData("speed")}moveRight(){this.body.velocity.x=this.getData("speed")}explode(){this.setTexture("sprExplosion"),this.setScale(2),this.play("sprExplosion"),this.scene.sfx.explosion.play(),this.on("animationcomplete",(function(){this.scene.scene.start("GameOver",{score:this.scene.score}),this.scene.score=0}),this)}update(){if(this.body.setVelocity(0,0),this.x=Phaser.Math.Clamp(this.x,0,this.scene.game.config.width),this.y=Phaser.Math.Clamp(this.y,0,this.scene.game.config.height),this.getData("rounds")===this.rounds&&this.scene.reloadMsg.setText(""),this.getData("rounds")>0){if(this.getData("isShooting"))if(this.getData("timerShootTick")<this.getData("timerShootDelay"))this.setData("timerShootTick",this.getData("timerShootTick")+1);else{const t=new m(this.scene,this.x,this.y,"playerMissile",0,-300);t.setScale(.05),this.scene.playerMissiles.add(t),this.scene.sfx.laser.play(),this.setData("timerShootTick",0),this.setData("rounds",this.getData("rounds")-1)}}else this.scene.reloadMsg.setText("RELOADING ROUNDS..."),setTimeout((()=>{this.setData("rounds",this.rounds)}),3e3)}};class f extends Phaser.Scene{constructor(){super({key:"GamePlay"}),this.score=0}preload(){this.load.spritesheet("sprExplosion",r,{frameWidth:32,frameHeight:32}),this.load.image("bg",e),this.load.image("airplane",a),this.load.image("rocketLauncher",o),this.load.image("playerMissile",h),this.load.image("enemyBomb",n),this.load.audio("sndExplode",c),this.load.audio("sndMissile",l)}create(){this.anims.create({key:"sprExplosion",frames:this.anims.generateFrameNumbers("sprExplosion"),frameRate:20,repeat:0}),this.sfx={explosion:this.sound.add("sndExplode"),laser:this.sound.add("sndMissile")},this.add.image(this.game.config.width/2,this.game.config.height/2,"bg").setScale(.5),this.strayPlanes=this.add.group(),this.playerMissiles=this.add.group(),this.enemyBombs=this.add.group(),this.time.addEvent({delay:500,callback:()=>{const t=new p(this,this.game.config.width,Phaser.Math.Between(this.game.config.height/15,this.game.config.height/4),"airplane",400,700);t.setScale(.05*Phaser.Math.Between(5,10)),this.strayPlanes.add(t)},callbackScope:this,loop:!0}),this.time.addEvent({delay:5e3,callback:()=>{const t=this.strayPlanes.getChildren()[Phaser.Math.Between(0,this.strayPlanes.getChildren().length-1)],e=this.player.x-t.x,s=this.player.y-t.y,i=Math.atan2(s,e),a=new m(this,t.x,t.y,"enemyBomb",200*Math.cos(i),200*Math.sin(i));this.enemyBombs.add(a)},callbackScope:this,loop:!0}),this.player=new y(this,this.game.config.width/2.5,.9*this.game.config.height,"rocketLauncher",20),this.cursors=this.input.keyboard.createCursorKeys(),this.physics.add.collider(this.playerMissiles,this.strayPlanes,(function(t,e){e&&(e.explode(),t.destroy())})),this.physics.add.collider(this.enemyBombs,this.player,(function(t,e){e&&(e.explode(),t.destroy())})),this.reloadMsg=this.add.text(.5*this.game.config.width,.6*this.game.config.height,"",{fontFamily:"monospace",fontSize:30,fontStyle:"bold",color:"red",align:"center"}),this.reloadMsg.setOrigin(.5)}update(){this.player.update(),this.cursors.left.isDown?this.player.moveLeft():this.cursors.right.isDown&&this.player.moveRight(),this.cursors.up.isDown?this.player.setData("isShooting",!0):(this.player.setData("timerShootTick",this.player.getData("timerShootDelay")-1),this.player.setData("isShooting",!1)),d(this,this.playerMissiles.getChildren()),d(this,this.strayPlanes.getChildren()),d(this,this.enemyBombs.getChildren())}}const u=f;class b extends Phaser.Scene{constructor(){super({key:"GameOver"}),this.gameID="bXHIzTBstNE7F6Arp2tl",this.baseURL="https://us-central1-js-capstone-backend.cloudfunctions.net/api"}init(t){this.score=t.score}preload(){this.load.image("bg",e)}create(){this.add.image(this.game.config.width/2,this.game.config.height/2,"bg").setScale(.5),this.add.text(.5*this.game.config.width,.15*this.game.config.height,"Game Over",{fontFamily:"monospace",fontSize:40,fontStyle:"bold",color:"red",align:"center"}).setOrigin(.5),this.add.text(.5*this.game.config.width,.2*this.game.config.height,`Your Score: ${this.score}`,{fontFamily:"monospace",fontSize:30,fontStyle:"bold",color:"#000",align:"center"}).setOrigin(.5),this.add.text(.5*this.game.config.width,.27*this.game.config.height,"Top Scores",{fontFamily:"monospace",fontSize:36,fontStyle:"bold",color:"#000",align:"center"});const t=this.add.text(.5*this.game.config.width,.4*this.game.config.height,"Fetching...",{fontFamily:"monospace",fontSize:24,fontStyle:"bold",color:"#000",align:"center"}),e=t=>{fetch(`${this.baseURL}/games/${this.gameID}/scores/`,{mode:"cors",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(console.log("Posted"))};(()=>{fetch(`${this.baseURL}/games/${this.gameID}/scores/`,{mode:"cors"}).then((t=>t.json())).then((s=>{const i=s.result,a={user:localStorage.getItem("playerName"),score:this.score};"Guest"!==a.user&&(i.push(a),e(a));const o=i.sort(((t,e)=>t.score>=e.score?-1:1)),h=o.length>5?o.slice(0,5):o;let n=.35,r=1;t.setText(""),h.forEach((t=>{this.add.text(.5*this.game.config.width,this.game.config.height*n,`${r}. ${t.user} ${t.score}`,{fontFamily:"monospace",fontSize:24,fontStyle:"bold",color:"#000",align:"center"}),n+=.05,r+=1}))}))})(),this.restart=this.add.text(.5*this.game.config.width,.65*this.game.config.height,"< PLAY AGAIN >",{fontFamily:"monospace",fontSize:30,fontStyle:"bold",color:"red",align:"center"}),this.restart.setOrigin(.5),this.restart.setInteractive(),this.restart.on("pointerup",(function(){this.scene.start("GamePlay")}),this)}}const S=b,x={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,backgroundColor:"black",physics:{default:"arcade",arcade:{gravity:{x:0,y:0}}},scene:[i,u,S],pixelArt:!0,roundPixels:!0};new Phaser.Game(x)})();